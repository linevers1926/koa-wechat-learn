{"version":3,"sources":["identity.js"],"names":[],"mappings":"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","file":"identity-compiled.js","sourcesContent":["// Copyright 2016 Joyent, Inc.\n\nmodule.exports = Identity;\n\nvar assert = require('assert-plus');\nvar algs = require('./algs');\nvar crypto = require('crypto');\nvar Fingerprint = require('./fingerprint');\nvar Signature = require('./signature');\nvar errs = require('./errors');\nvar util = require('util');\nvar utils = require('./utils');\nvar asn1 = require('asn1');\n\n/*JSSTYLED*/\nvar DNS_NAME_RE = /^([*]|[a-z0-9][a-z0-9\\-]{0,62})(?:\\.([*]|[a-z0-9][a-z0-9\\-]{0,62}))*$/i;\n\nvar oids = {};\noids.cn = '2.5.4.3';\noids.o = '2.5.4.10';\noids.ou = '2.5.4.11';\noids.l = '2.5.4.7';\noids.s = '2.5.4.8';\noids.c = '2.5.4.6';\noids.sn = '2.5.4.4';\noids.dc = '0.9.2342.19200300.100.1.25';\noids.uid = '0.9.2342.19200300.100.1.1';\noids.mail = '0.9.2342.19200300.100.1.3';\n\nvar unoids = {};\nObject.keys(oids).forEach(function (k) {\n\tunoids[oids[k]] = k;\n});\n\nfunction Identity(opts) {\n\tvar self = this;\n\tassert.object(opts, 'options');\n\tassert.arrayOfObject(opts.components, 'options.components');\n\tthis.components = opts.components;\n\tthis.componentLookup = {};\n\tthis.components.forEach(function (c) {\n\t\tif (c.name && !c.oid)\n\t\t\tc.oid = oids[c.name];\n\t\tif (c.oid && !c.name)\n\t\t\tc.name = unoids[c.oid];\n\t\tif (self.componentLookup[c.name] === undefined)\n\t\t\tself.componentLookup[c.name] = [];\n\t\tself.componentLookup[c.name].push(c);\n\t});\n\tif (this.componentLookup.cn && this.componentLookup.cn.length > 0) {\n\t\tthis.cn = this.componentLookup.cn[0].value;\n\t}\n\tassert.optionalString(opts.type, 'options.type');\n\tif (opts.type === undefined) {\n\t\tif (this.components.length === 1 &&\n\t\t    this.componentLookup.cn &&\n\t\t    this.componentLookup.cn.length === 1 &&\n\t\t    this.componentLookup.cn[0].value.match(DNS_NAME_RE)) {\n\t\t\tthis.type = 'host';\n\t\t\tthis.hostname = this.componentLookup.cn[0].value;\n\n\t\t} else if (this.componentLookup.dc &&\n\t\t    this.components.length === this.componentLookup.dc.length) {\n\t\t\tthis.type = 'host';\n\t\t\tthis.hostname = this.componentLookup.dc.map(\n\t\t\t    function (c) {\n\t\t\t\treturn (c.value);\n\t\t\t}).join('.');\n\n\t\t} else if (this.componentLookup.uid &&\n\t\t    this.components.length ===\n\t\t    this.componentLookup.uid.length) {\n\t\t\tthis.type = 'user';\n\t\t\tthis.uid = this.componentLookup.uid[0].value;\n\n\t\t} else if (this.componentLookup.cn &&\n\t\t    this.componentLookup.cn.length === 1 &&\n\t\t    this.componentLookup.cn[0].value.match(DNS_NAME_RE)) {\n\t\t\tthis.type = 'host';\n\t\t\tthis.hostname = this.componentLookup.cn[0].value;\n\n\t\t} else if (this.componentLookup.uid &&\n\t\t    this.componentLookup.uid.length === 1) {\n\t\t\tthis.type = 'user';\n\t\t\tthis.uid = this.componentLookup.uid[0].value;\n\n\t\t} else if (this.componentLookup.mail &&\n\t\t    this.componentLookup.mail.length === 1) {\n\t\t\tthis.type = 'email';\n\t\t\tthis.email = this.componentLookup.mail[0].value;\n\n\t\t} else if (this.componentLookup.cn &&\n\t\t    this.componentLookup.cn.length === 1) {\n\t\t\tthis.type = 'user';\n\t\t\tthis.uid = this.componentLookup.cn[0].value;\n\n\t\t} else {\n\t\t\tthis.type = 'unknown';\n\t\t}\n\t} else {\n\t\tthis.type = opts.type;\n\t\tif (this.type === 'host')\n\t\t\tthis.hostname = opts.hostname;\n\t\telse if (this.type === 'user')\n\t\t\tthis.uid = opts.uid;\n\t\telse if (this.type === 'email')\n\t\t\tthis.email = opts.email;\n\t\telse\n\t\t\tthrow (new Error('Unknown type ' + this.type));\n\t}\n}\n\nIdentity.prototype.toString = function () {\n\treturn (this.components.map(function (c) {\n\t\treturn (c.name.toUpperCase() + '=' + c.value);\n\t}).join(', '));\n};\n\nIdentity.prototype.toAsn1 = function (der, tag) {\n\tder.startSequence(tag);\n\tthis.components.forEach(function (c) {\n\t\tder.startSequence(asn1.Ber.Constructor | asn1.Ber.Set);\n\t\tder.startSequence();\n\t\tder.writeOID(c.oid);\n\t\tder.writeString(c.value, asn1.Ber.PrintableString);\n\t\tder.endSequence();\n\t\tder.endSequence();\n\t});\n\tder.endSequence();\n};\n\nfunction globMatch(a, b) {\n\tif (a === '**' || b === '**')\n\t\treturn (true);\n\tvar aParts = a.split('.');\n\tvar bParts = b.split('.');\n\tif (aParts.length !== bParts.length)\n\t\treturn (false);\n\tfor (var i = 0; i < aParts.length; ++i) {\n\t\tif (aParts[i] === '*' || bParts[i] === '*')\n\t\t\tcontinue;\n\t\tif (aParts[i] !== bParts[i])\n\t\t\treturn (false);\n\t}\n\treturn (true);\n}\n\nIdentity.prototype.equals = function (other) {\n\tif (!Identity.isIdentity(other, [1, 0]))\n\t\treturn (false);\n\tif (other.components.length !== this.components.length)\n\t\treturn (false);\n\tfor (var i = 0; i < this.components.length; ++i) {\n\t\tif (this.components[i].oid !== other.components[i].oid)\n\t\t\treturn (false);\n\t\tif (!globMatch(this.components[i].value,\n\t\t    other.components[i].value)) {\n\t\t\treturn (false);\n\t\t}\n\t}\n\treturn (true);\n};\n\nIdentity.forHost = function (hostname) {\n\tassert.string(hostname, 'hostname');\n\treturn (new Identity({\n\t\ttype: 'host',\n\t\thostname: hostname,\n\t\tcomponents: [ { name: 'cn', value: hostname } ]\n\t}));\n};\n\nIdentity.forUser = function (uid) {\n\tassert.string(uid, 'uid');\n\treturn (new Identity({\n\t\ttype: 'user',\n\t\tuid: uid,\n\t\tcomponents: [ { name: 'uid', value: uid } ]\n\t}));\n};\n\nIdentity.forEmail = function (email) {\n\tassert.string(email, 'email');\n\treturn (new Identity({\n\t\ttype: 'email',\n\t\temail: email,\n\t\tcomponents: [ { name: 'mail', value: email } ]\n\t}));\n};\n\nIdentity.parseDN = function (dn) {\n\tassert.string(dn, 'dn');\n\tvar parts = dn.split(',');\n\tvar cmps = parts.map(function (c) {\n\t\tc = c.trim();\n\t\tvar eqPos = c.indexOf('=');\n\t\tvar name = c.slice(0, eqPos).toLowerCase();\n\t\tvar value = c.slice(eqPos + 1);\n\t\treturn ({ name: name, value: value });\n\t});\n\treturn (new Identity({ components: cmps }));\n};\n\nIdentity.parseAsn1 = function (der, top) {\n\tvar components = [];\n\tder.readSequence(top);\n\tvar end = der.offset + der.length;\n\twhile (der.offset < end) {\n\t\tder.readSequence(asn1.Ber.Constructor | asn1.Ber.Set);\n\t\tvar after = der.offset + der.length;\n\t\tder.readSequence();\n\t\tvar oid = der.readOID();\n\t\tvar type = der.peek();\n\t\tvar value;\n\t\tswitch (type) {\n\t\tcase asn1.Ber.PrintableString:\n\t\tcase asn1.Ber.IA5String:\n\t\tcase asn1.Ber.OctetString:\n\t\tcase asn1.Ber.T61String:\n\t\t\tvalue = der.readString(type);\n\t\t\tbreak;\n\t\tcase asn1.Ber.Utf8String:\n\t\t\tvalue = der.readString(type, true);\n\t\t\tvalue = value.toString('utf8');\n\t\t\tbreak;\n\t\tcase asn1.Ber.CharacterString:\n\t\tcase asn1.Ber.BMPString:\n\t\t\tvalue = der.readString(type, true);\n\t\t\tvalue = value.toString('utf16le');\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow (new Error('Unknown asn1 type ' + type));\n\t\t}\n\t\tcomponents.push({ oid: oid, value: value });\n\t\tder._offset = after;\n\t}\n\tder._offset = end;\n\treturn (new Identity({\n\t\tcomponents: components\n\t}));\n};\n\nIdentity.isIdentity = function (obj, ver) {\n\treturn (utils.isCompatible(obj, Identity, ver));\n};\n\n/*\n * API versions for Identity:\n * [1,0] -- initial ver\n */\nIdentity.prototype._sshpkApiVersion = [1, 0];\n\nIdentity._oldVersionDetect = function (obj) {\n\treturn ([1, 0]);\n};\n"]}