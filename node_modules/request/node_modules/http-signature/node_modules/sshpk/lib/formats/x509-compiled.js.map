{"version":3,"sources":["x509.js"],"names":[],"mappings":"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","file":"x509-compiled.js","sourcesContent":["// Copyright 2016 Joyent, Inc.\n\nmodule.exports = {\n\tread: read,\n\tverify: verify,\n\tsign: sign,\n\twrite: write\n};\n\nvar assert = require('assert-plus');\nvar asn1 = require('asn1');\nvar algs = require('../algs');\nvar utils = require('../utils');\nvar Key = require('../key');\nvar PrivateKey = require('../private-key');\nvar pem = require('./pem');\nvar Identity = require('../identity');\nvar Signature = require('../signature');\nvar Certificate = require('../certificate');\nvar pkcs8 = require('./pkcs8');\n\n/*\n * This file is based on RFC5280 (X.509).\n */\n\n/* Helper to read in a single mpint */\nfunction readMPInt(der, nm) {\n\tassert.strictEqual(der.peek(), asn1.Ber.Integer,\n\t    nm + ' is not an Integer');\n\treturn (utils.mpNormalize(der.readString(asn1.Ber.Integer, true)));\n}\n\nfunction verify(cert, key) {\n\tvar sig = cert.signatures.x509;\n\tassert.object(sig, 'x509 signature');\n\n\tvar algParts = sig.algo.split('-');\n\tif (algParts[0] !== key.type)\n\t\treturn (false);\n\n\tvar blob = sig.cache;\n\tif (blob === undefined) {\n\t\tvar der = new asn1.BerWriter();\n\t\twriteTBSCert(cert, der);\n\t\tblob = der.buffer;\n\t}\n\n\tvar verifier = key.createVerify(algParts[1]);\n\tverifier.write(blob);\n\treturn (verifier.verify(sig.signature));\n}\n\nfunction Local(i) {\n\treturn (asn1.Ber.Context | asn1.Ber.Constructor | i);\n}\n\nfunction Context(i) {\n\treturn (asn1.Ber.Context | i);\n}\n\nvar SIGN_ALGS = {\n\t'rsa-md5': '1.2.840.113549.1.1.4',\n\t'rsa-sha1': '1.2.840.113549.1.1.5',\n\t'rsa-sha256': '1.2.840.113549.1.1.11',\n\t'rsa-sha384': '1.2.840.113549.1.1.12',\n\t'rsa-sha512': '1.2.840.113549.1.1.13',\n\t'dsa-sha1': '1.2.840.10040.4.3',\n\t'dsa-sha256': '2.16.840.1.101.3.4.3.2',\n\t'ecdsa-sha1': '1.2.840.10045.4.1',\n\t'ecdsa-sha256': '1.2.840.10045.4.3.2',\n\t'ecdsa-sha384': '1.2.840.10045.4.3.3',\n\t'ecdsa-sha512': '1.2.840.10045.4.3.4'\n};\nObject.keys(SIGN_ALGS).forEach(function (k) {\n\tSIGN_ALGS[SIGN_ALGS[k]] = k;\n});\nSIGN_ALGS['1.3.14.3.2.3'] = 'rsa-md5';\nSIGN_ALGS['1.3.14.3.2.29'] = 'rsa-sha1';\n\nvar EXTS = {\n\t'issuerKeyId': '2.5.29.35',\n\t'altName': '2.5.29.17'\n};\n\nfunction read(buf, options) {\n\tif (typeof (buf) === 'string') {\n\t\tbuf = new Buffer(buf, 'binary');\n\t}\n\tassert.buffer(buf, 'buf');\n\n\tvar der = new asn1.BerReader(buf);\n\n\tder.readSequence();\n\tif (Math.abs(der.length - der.remain) > 1) {\n\t\tthrow (new Error('DER sequence does not contain whole byte ' +\n\t\t    'stream'));\n\t}\n\n\tvar tbsStart = der.offset;\n\tder.readSequence();\n\tvar sigOffset = der.offset + der.length;\n\tvar tbsEnd = sigOffset;\n\n\tif (der.peek() === Local(0)) {\n\t\tder.readSequence(Local(0));\n\t\tvar version = der.readInt();\n\t\tassert.ok(version <= 3,\n\t\t    'only x.509 versions up to v3 supported');\n\t}\n\n\tvar cert = {};\n\tcert.signatures = {};\n\tvar sig = (cert.signatures.x509 = {});\n\tsig.extras = {};\n\n\tcert.serial = readMPInt(der, 'serial');\n\n\tder.readSequence();\n\tvar after = der.offset + der.length;\n\tvar certAlgOid = der.readOID();\n\tvar certAlg = SIGN_ALGS[certAlgOid];\n\tif (certAlg === undefined)\n\t\tthrow (new Error('unknown signature algorithm ' + certAlgOid));\n\n\tder._offset = after;\n\tcert.issuer = Identity.parseAsn1(der);\n\n\tder.readSequence();\n\tcert.validFrom = readDate(der);\n\tcert.validUntil = readDate(der);\n\n\tcert.subjects = [Identity.parseAsn1(der)];\n\n\tder.readSequence();\n\tafter = der.offset + der.length;\n\tcert.subjectKey = pkcs8.readPkcs8(undefined, 'public', der);\n\tder._offset = after;\n\n\t/* issuerUniqueID */\n\tif (der.peek() === Local(1)) {\n\t\tder.readSequence(Local(1));\n\t\tsig.extras.issuerUniqueID =\n\t\t    buf.slice(der.offset, der.offset + der.length);\n\t\tder._offset += der.length;\n\t}\n\n\t/* subjectUniqueID */\n\tif (der.peek() === Local(2)) {\n\t\tder.readSequence(Local(2));\n\t\tsig.extras.subjectUniqueID =\n\t\t    buf.slice(der.offset, der.offset + der.length);\n\t\tder._offset += der.length;\n\t}\n\n\t/* extensions */\n\tif (der.peek() === Local(3)) {\n\t\tder.readSequence(Local(3));\n\t\tvar extEnd = der.offset + der.length;\n\t\tder.readSequence();\n\n\t\twhile (der.offset < extEnd)\n\t\t\treadExtension(cert, buf, der);\n\n\t\tassert.strictEqual(der.offset, extEnd);\n\t}\n\n\tassert.strictEqual(der.offset, sigOffset);\n\n\tder.readSequence();\n\tafter = der.offset + der.length;\n\tvar sigAlgOid = der.readOID();\n\tvar sigAlg = SIGN_ALGS[sigAlgOid];\n\tif (sigAlg === undefined)\n\t\tthrow (new Error('unknown signature algorithm ' + sigAlgOid));\n\tder._offset = after;\n\n\tvar sigData = der.readString(asn1.Ber.BitString, true);\n\tif (sigData[0] === 0)\n\t\tsigData = sigData.slice(1);\n\tvar algParts = sigAlg.split('-');\n\n\tsig.signature = Signature.parse(sigData, algParts[0], 'asn1');\n\tsig.signature.hashAlgorithm = algParts[1];\n\tsig.algo = sigAlg;\n\tsig.cache = buf.slice(tbsStart, tbsEnd);\n\n\treturn (new Certificate(cert));\n}\n\nfunction readDate(der) {\n\tif (der.peek() === asn1.Ber.UTCTime) {\n\t\treturn (utcTimeToDate(der.readString(asn1.Ber.UTCTime)));\n\t} else if (der.peek() === asn1.Ber.GeneralizedTime) {\n\t\treturn (gTimeToDate(der.readString(asn1.Ber.GeneralizedTime)));\n\t} else {\n\t\tthrow (new Error('Unsupported date format'));\n\t}\n}\n\n/* RFC5280, section 4.2.1.6 (GeneralName type) */\nvar ALTNAME = {\n\tOtherName: Local(0),\n\tRFC822Name: Context(1),\n\tDNSName: Context(2),\n\tX400Address: Local(3),\n\tDirectoryName: Local(4),\n\tEDIPartyName: Local(5),\n\tURI: Context(6),\n\tIPAddress: Context(7),\n\tOID: Context(8)\n};\n\nfunction readExtension(cert, buf, der) {\n\tder.readSequence();\n\tvar after = der.offset + der.length;\n\tvar extId = der.readOID();\n\tvar id;\n\tvar sig = cert.signatures.x509;\n\tsig.extras.exts = [];\n\n\tvar critical;\n\tif (der.peek() === asn1.Ber.Boolean)\n\t\tcritical = der.readBoolean();\n\n\tswitch (extId) {\n\tcase (EXTS.altName):\n\t\tder.readSequence(asn1.Ber.OctetString);\n\t\tder.readSequence();\n\t\tvar aeEnd = der.offset + der.length;\n\t\twhile (der.offset < aeEnd) {\n\t\t\tswitch (der.peek()) {\n\t\t\tcase ALTNAME.OtherName:\n\t\t\tcase ALTNAME.EDIPartyName:\n\t\t\t\tder.readSequence();\n\t\t\t\tder._offset += der.length;\n\t\t\t\tbreak;\n\t\t\tcase ALTNAME.OID:\n\t\t\t\tder.readOID(ALTNAME.OID);\n\t\t\t\tbreak;\n\t\t\tcase ALTNAME.RFC822Name:\n\t\t\t\t/* RFC822 specifies email addresses */\n\t\t\t\tvar email = der.readString(ALTNAME.RFC822Name);\n\t\t\t\tid = Identity.forEmail(email);\n\t\t\t\tif (!cert.subjects[0].equals(id))\n\t\t\t\t\tcert.subjects.push(id);\n\t\t\t\tbreak;\n\t\t\tcase ALTNAME.DirectoryName:\n\t\t\t\tder.readSequence(ALTNAME.DirectoryName);\n\t\t\t\tid = Identity.parseAsn1(der);\n\t\t\t\tif (!cert.subjects[0].equals(id))\n\t\t\t\t\tcert.subjects.push(id);\n\t\t\t\tbreak;\n\t\t\tcase ALTNAME.DNSName:\n\t\t\t\tvar host = der.readString(\n\t\t\t\t    ALTNAME.DNSName);\n\t\t\t\tid = Identity.forHost(host);\n\t\t\t\tif (!cert.subjects[0].equals(id))\n\t\t\t\t\tcert.subjects.push(id);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tder.readString(der.peek());\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tsig.extras.exts.push({ oid: extId, critical: critical });\n\t\tbreak;\n\tdefault:\n\t\tsig.extras.exts.push({\n\t\t\toid: extId,\n\t\t\tcritical: critical,\n\t\t\tdata: der.readString(asn1.Ber.OctetString, true)\n\t\t});\n\t\tbreak;\n\t}\n\n\tder._offset = after;\n}\n\nvar UTCTIME_RE =\n    /^([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})?Z$/;\nfunction utcTimeToDate(t) {\n\tvar m = t.match(UTCTIME_RE);\n\tassert.ok(m, 'timestamps must be in UTC');\n\tvar d = new Date();\n\n\tvar thisYear = d.getUTCFullYear();\n\tvar century = Math.floor(thisYear / 100) * 100;\n\n\tvar year = parseInt(m[1], 10);\n\tif (thisYear % 100 < 50 && year >= 60)\n\t\tyear += (century - 1);\n\telse\n\t\tyear += century;\n\td.setUTCFullYear(year, parseInt(m[2], 10) - 1, parseInt(m[3], 10));\n\td.setUTCHours(parseInt(m[4], 10), parseInt(m[5], 10));\n\tif (m[6] && m[6].length > 0)\n\t\td.setUTCSeconds(parseInt(m[6], 10));\n\treturn (d);\n}\n\nvar GTIME_RE =\n    /^([0-9]{4})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})?Z$/;\nfunction gTimeToDate(t) {\n\tvar m = t.match(GTIME_RE);\n\tassert.ok(m);\n\tvar d = new Date();\n\n\td.setUTCFullYear(parseInt(m[1], 10), parseInt(m[2], 10) - 1,\n\t    parseInt(m[3], 10));\n\td.setUTCHours(parseInt(m[4], 10), parseInt(m[5], 10));\n\tif (m[6] && m[6].length > 0)\n\t\td.setUTCSeconds(parseInt(m[6], 10));\n\treturn (d);\n}\n\nfunction zeroPad(n) {\n\tvar s = '' + n;\n\twhile (s.length < 2)\n\t\ts = '0' + s;\n\treturn (s);\n}\n\nfunction dateToUTCTime(d) {\n\tvar s = '';\n\ts += zeroPad(d.getUTCFullYear() % 100);\n\ts += zeroPad(d.getUTCMonth() + 1);\n\ts += zeroPad(d.getUTCDate());\n\ts += zeroPad(d.getUTCHours());\n\ts += zeroPad(d.getUTCMinutes());\n\ts += zeroPad(d.getUTCSeconds());\n\ts += 'Z';\n\treturn (s);\n}\n\nfunction sign(cert, key) {\n\tif (cert.signatures.x509 === undefined)\n\t\tcert.signatures.x509 = {};\n\tvar sig = cert.signatures.x509;\n\n\tsig.algo = key.type + '-' + key.defaultHashAlgorithm();\n\tif (SIGN_ALGS[sig.algo] === undefined)\n\t\treturn (false);\n\n\tvar der = new asn1.BerWriter();\n\twriteTBSCert(cert, der);\n\tvar blob = der.buffer;\n\tsig.cache = blob;\n\n\tvar signer = key.createSign();\n\tsigner.write(blob);\n\tcert.signatures.x509.signature = signer.sign();\n\n\treturn (true);\n}\n\nfunction write(cert, options) {\n\tvar sig = cert.signatures.x509;\n\tassert.object(sig, 'x509 signature');\n\n\tvar der = new asn1.BerWriter();\n\tder.startSequence();\n\tif (sig.cache) {\n\t\tder._ensure(sig.cache.length);\n\t\tsig.cache.copy(der._buf, der._offset);\n\t\tder._offset += sig.cache.length;\n\t} else {\n\t\twriteTBSCert(cert, der);\n\t}\n\n\tder.startSequence();\n\tder.writeOID(SIGN_ALGS[sig.algo]);\n\tif (sig.algo.match(/^rsa-/))\n\t\tder.writeNull();\n\tder.endSequence();\n\n\tvar sigData = sig.signature.toBuffer('asn1');\n\tvar data = new Buffer(sigData.length + 1);\n\tdata[0] = 0;\n\tsigData.copy(data, 1);\n\tder.writeBuffer(data, asn1.Ber.BitString);\n\tder.endSequence();\n\n\treturn (der.buffer);\n}\n\nfunction writeTBSCert(cert, der) {\n\tvar sig = cert.signatures.x509;\n\tassert.object(sig, 'x509 signature');\n\n\tder.startSequence();\n\n\tder.startSequence(Local(0));\n\tder.writeInt(2);\n\tder.endSequence();\n\n\tder.writeBuffer(utils.mpNormalize(cert.serial), asn1.Ber.Integer);\n\n\tder.startSequence();\n\tder.writeOID(SIGN_ALGS[sig.algo]);\n\tder.endSequence();\n\n\tcert.issuer.toAsn1(der);\n\n\tder.startSequence();\n\tder.writeString(dateToUTCTime(cert.validFrom), asn1.Ber.UTCTime);\n\tder.writeString(dateToUTCTime(cert.validUntil), asn1.Ber.UTCTime);\n\tder.endSequence();\n\n\tvar subject = cert.subjects[0];\n\tvar altNames = cert.subjects.slice(1);\n\tsubject.toAsn1(der);\n\n\tpkcs8.writePkcs8(der, cert.subjectKey);\n\n\tif (sig.extras && sig.extras.issuerUniqueID) {\n\t\tder.writeBuffer(sig.extras.issuerUniqueID, Local(1));\n\t}\n\n\tif (sig.extras && sig.extras.subjectUniqueID) {\n\t\tder.writeBuffer(sig.extras.subjectUniqueID, Local(2));\n\t}\n\n\tif (altNames.length > 0 || subject.type === 'host' ||\n\t    (sig.extras && sig.extras.exts)) {\n\t\tder.startSequence(Local(3));\n\t\tder.startSequence();\n\n\t\tvar exts = [\n\t\t\t{ oid: EXTS.altName }\n\t\t];\n\t\tif (sig.extras && sig.extras.exts)\n\t\t\texts = sig.extras.exts;\n\n\t\tfor (var i = 0; i < exts.length; ++i) {\n\t\t\tder.startSequence();\n\t\t\tder.writeOID(exts[i].oid);\n\n\t\t\tif (exts[i].critical !== undefined)\n\t\t\t\tder.writeBoolean(exts[i].critical);\n\n\t\t\tif (exts[i].oid === EXTS.altName) {\n\t\t\t\tder.startSequence(asn1.Ber.OctetString);\n\t\t\t\tder.startSequence();\n\t\t\t\tif (subject.type === 'host') {\n\t\t\t\t\tder.writeString(subject.hostname,\n\t\t\t\t\t    Context(2));\n\t\t\t\t}\n\t\t\t\tfor (var j = 0; j < altNames.length; ++j) {\n\t\t\t\t\tif (altNames[j].type === 'host') {\n\t\t\t\t\t\tder.writeString(\n\t\t\t\t\t\t    altNames[j].hostname,\n\t\t\t\t\t\t    ALTNAME.DNSName);\n\t\t\t\t\t} else if (altNames[j].type ===\n\t\t\t\t\t    'email') {\n\t\t\t\t\t\tder.writeString(\n\t\t\t\t\t\t    altNames[j].email,\n\t\t\t\t\t\t    ALTNAME.RFC822Name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t/*\n\t\t\t\t\t\t * Encode anything else as a\n\t\t\t\t\t\t * DN style name for now.\n\t\t\t\t\t\t */\n\t\t\t\t\t\tder.startSequence(\n\t\t\t\t\t\t    ALTNAME.DirectoryName);\n\t\t\t\t\t\taltNames[j].toAsn1(der);\n\t\t\t\t\t\tder.endSequence();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tder.endSequence();\n\t\t\t\tder.endSequence();\n\t\t\t} else {\n\t\t\t\tder.writeBuffer(exts[i].data,\n\t\t\t\t    asn1.Ber.OctetString);\n\t\t\t}\n\n\t\t\tder.endSequence();\n\t\t}\n\n\t\tder.endSequence();\n\t\tder.endSequence();\n\t}\n\n\tder.endSequence();\n}\n"]}