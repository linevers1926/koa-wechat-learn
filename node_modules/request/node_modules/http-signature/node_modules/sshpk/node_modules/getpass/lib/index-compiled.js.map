{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/*\n * Copyright 2016, Joyent, Inc. All rights reserved.\n * Author: Alex Wilson <alex.wilson@joyent.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to\n * deal in the Software without restriction, including without limitation the\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n * sell copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n*/\n\nmodule.exports = {\n\tgetPass: getPass\n};\n\nconst mod_tty = require('tty');\nconst mod_fs = require('fs');\nconst mod_assert = require('assert-plus');\n\nvar BACKSPACE = String.fromCharCode(127);\nvar CTRLC = '\\u0003';\nvar CTRLD = '\\u0004';\n\nfunction getPass(opts, cb) {\n\tif (typeof (opts) === 'function' && cb === undefined) {\n\t\tcb = opts;\n\t\topts = {};\n\t}\n\tmod_assert.object(opts, 'options');\n\tmod_assert.func(cb, 'callback');\n\n\tmod_assert.optionalString(opts.prompt, 'options.prompt');\n\tif (opts.prompt === undefined)\n\t\topts.prompt = 'Password';\n\n\topenTTY(function (err, rfd, wfd, rtty, wtty) {\n\t\tif (err) {\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\twtty.write(opts.prompt + ':');\n\t\trtty.resume();\n\t\trtty.setRawMode(true);\n\t\trtty.resume();\n\t\trtty.setEncoding('utf8');\n\n\t\tvar pw = '';\n\t\trtty.on('data', onData);\n\n\t\tfunction onData(data) {\n\t\t\tvar str = data.toString('utf8');\n\t\t\tfor (var i = 0; i < str.length; ++i) {\n\t\t\t\tvar ch = str[i];\n\t\t\t\tswitch (ch) {\n\t\t\t\tcase '\\r':\n\t\t\t\tcase '\\n':\n\t\t\t\tcase CTRLD:\n\t\t\t\t\tcleanup();\n\t\t\t\t\tcb(null, pw);\n\t\t\t\t\treturn;\n\t\t\t\tcase CTRLC:\n\t\t\t\t\tcleanup();\n\t\t\t\t\tcb(new Error('Aborted'));\n\t\t\t\t\treturn;\n\t\t\t\tcase BACKSPACE:\n\t\t\t\t\tpw = pw.slice(0, pw.length - 1);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tpw += ch;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction cleanup() {\n\t\t\twtty.write('\\r\\n');\n\t\t\trtty.setRawMode(false);\n\t\t\trtty.pause();\n\t\t\trtty.removeListener('data', onData);\n\t\t\tif (wfd !== undefined && wfd !== rfd) {\n\t\t\t\twtty.end();\n\t\t\t\tmod_fs.closeSync(wfd);\n\t\t\t}\n\t\t\tif (rfd !== undefined) {\n\t\t\t\trtty.end();\n\t\t\t\tmod_fs.closeSync(rfd);\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction openTTY(cb) {\n\tmod_fs.open('/dev/tty', 'r+', function (err, rttyfd) {\n\t\tif ((err && (err.code === 'ENOENT' || err.code === 'EACCES')) ||\n\t\t    (process.version.match(/^v0[.][0-8][.]/))) {\n\t\t\tcb(null, undefined, undefined, process.stdin,\n\t\t\t    process.stdout);\n\t\t\treturn;\n\t\t}\n\t\tvar rtty = new mod_tty.ReadStream(rttyfd);\n\t\tmod_fs.open('/dev/tty', 'w+', function (err3, wttyfd) {\n\t\t\tvar wtty = new mod_tty.WriteStream(wttyfd);\n\t\t\tif (err3) {\n\t\t\t\tcb(err3);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcb(null, rttyfd, wttyfd, rtty, wtty);\n\t\t});\n\t});\n}\n"]}