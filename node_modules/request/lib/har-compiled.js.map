{"version":3,"sources":["har.js"],"names":[],"mappings":"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","file":"har-compiled.js","sourcesContent":["'use strict'\n\nvar fs = require('fs')\nvar qs = require('querystring')\nvar validate = require('har-validator')\nvar extend = require('extend')\n\nfunction Har (request) {\n  this.request = request\n}\n\nHar.prototype.reducer = function (obj, pair) {\n  // new property ?\n  if (obj[pair.name] === undefined) {\n    obj[pair.name] = pair.value\n    return obj\n  }\n\n  // existing? convert to array\n  var arr = [\n    obj[pair.name],\n    pair.value\n  ]\n\n  obj[pair.name] = arr\n\n  return obj\n}\n\nHar.prototype.prep = function (data) {\n  // construct utility properties\n  data.queryObj = {}\n  data.headersObj = {}\n  data.postData.jsonObj = false\n  data.postData.paramsObj = false\n\n  // construct query objects\n  if (data.queryString && data.queryString.length) {\n    data.queryObj = data.queryString.reduce(this.reducer, {})\n  }\n\n  // construct headers objects\n  if (data.headers && data.headers.length) {\n    // loweCase header keys\n    data.headersObj = data.headers.reduceRight(function (headers, header) {\n      headers[header.name] = header.value\n      return headers\n    }, {})\n  }\n\n  // construct Cookie header\n  if (data.cookies && data.cookies.length) {\n    var cookies = data.cookies.map(function (cookie) {\n      return cookie.name + '=' + cookie.value\n    })\n\n    if (cookies.length) {\n      data.headersObj.cookie = cookies.join('; ')\n    }\n  }\n\n  // prep body\n  function some (arr) {\n    return arr.some(function (type) {\n      return data.postData.mimeType.indexOf(type) === 0\n    })\n  }\n\n  if (some([\n    'multipart/mixed',\n    'multipart/related',\n    'multipart/form-data',\n    'multipart/alternative'])) {\n\n    // reset values\n    data.postData.mimeType = 'multipart/form-data'\n  }\n\n  else if (some([\n    'application/x-www-form-urlencoded'])) {\n\n    if (!data.postData.params) {\n      data.postData.text = ''\n    } else {\n      data.postData.paramsObj = data.postData.params.reduce(this.reducer, {})\n\n      // always overwrite\n      data.postData.text = qs.stringify(data.postData.paramsObj)\n    }\n  }\n\n  else if (some([\n    'text/json',\n    'text/x-json',\n    'application/json',\n    'application/x-json'])) {\n\n    data.postData.mimeType = 'application/json'\n\n    if (data.postData.text) {\n      try {\n        data.postData.jsonObj = JSON.parse(data.postData.text)\n      } catch (e) {\n        this.request.debug(e)\n\n        // force back to text/plain\n        data.postData.mimeType = 'text/plain'\n      }\n    }\n  }\n\n  return data\n}\n\nHar.prototype.options = function (options) {\n  // skip if no har property defined\n  if (!options.har) {\n    return options\n  }\n\n  var har = {}\n  extend(har, options.har)\n\n  // only process the first entry\n  if (har.log && har.log.entries) {\n    har = har.log.entries[0]\n  }\n\n  // add optional properties to make validation successful\n  har.url = har.url || options.url || options.uri || options.baseUrl || '/'\n  har.httpVersion = har.httpVersion || 'HTTP/1.1'\n  har.queryString = har.queryString || []\n  har.headers = har.headers || []\n  har.cookies = har.cookies || []\n  har.postData = har.postData || {}\n  har.postData.mimeType = har.postData.mimeType || 'application/octet-stream'\n\n  har.bodySize = 0\n  har.headersSize = 0\n  har.postData.size = 0\n\n  if (!validate.request(har)) {\n    return options\n  }\n\n  // clean up and get some utility properties\n  var req = this.prep(har)\n\n  // construct new options\n  if (req.url) {\n    options.url = req.url\n  }\n\n  if (req.method) {\n    options.method = req.method\n  }\n\n  if (Object.keys(req.queryObj).length) {\n    options.qs = req.queryObj\n  }\n\n  if (Object.keys(req.headersObj).length) {\n    options.headers = req.headersObj\n  }\n\n  function test (type) {\n    return req.postData.mimeType.indexOf(type) === 0\n  }\n  if (test('application/x-www-form-urlencoded')) {\n    options.form = req.postData.paramsObj\n  }\n  else if (test('application/json')) {\n    if (req.postData.jsonObj) {\n      options.body = req.postData.jsonObj\n      options.json = true\n    }\n  }\n  else if (test('multipart/form-data')) {\n    options.formData = {}\n\n    req.postData.params.forEach(function (param) {\n      var attachment = {}\n\n      if (!param.fileName && !param.fileName && !param.contentType) {\n        options.formData[param.name] = param.value\n        return\n      }\n\n      // attempt to read from disk!\n      if (param.fileName && !param.value) {\n        attachment.value = fs.createReadStream(param.fileName)\n      } else if (param.value) {\n        attachment.value = param.value\n      }\n\n      if (param.fileName) {\n        attachment.options = {\n          filename: param.fileName,\n          contentType: param.contentType ? param.contentType : null\n        }\n      }\n\n      options.formData[param.name] = attachment\n    })\n  }\n  else {\n    if (req.postData.text) {\n      options.body = req.postData.text\n    }\n  }\n\n  return options\n}\n\nexports.Har = Har\n"]}