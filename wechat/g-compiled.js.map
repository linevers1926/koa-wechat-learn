{"version":3,"sources":["g.js"],"names":[],"mappings":";;;;AAIA;;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,aAAa,QAAQ,UAAR,CAAjB;AACA,IAAI,SAAS,QAAQ,UAAR,CAAb;AACA,IAAI,OAAO,QAAQ,QAAR,CAAX;;AAEA,OAAO,OAAP,GAAiB,UAAS,GAAT,EAAc;;AAE3B,WAAO,WAAW,IAAX,EAAiB;AACpB,gBAAQ,GAAR,CAAY,KAAK,MAAjB;;AAEA,YAAI,QAAQ,IAAI,KAAhB;AACA,YAAI,YAAY,KAAK,KAAL,CAAW,SAA3B;AACA,YAAI,QAAQ,KAAK,KAAL,CAAW,KAAvB;AACA,YAAI,YAAY,KAAK,KAAL,CAAW,SAA3B;AACA,YAAI,UAAU,KAAK,KAAL,CAAW,OAAzB;AACA,YAAI,MAAM,CAAC,KAAD,EAAQ,SAAR,EAAmB,KAAnB,EAA0B,IAA1B,GAAiC,IAAjC,CAAsC,EAAtC,CAAV;AACA,YAAI,MAAM,KAAK,GAAL,CAAV;;AAEA,YAAI,KAAK,MAAL,KAAgB,KAApB,EAA2B;AACvB,gBAAI,OAAO,SAAX,EAAsB;AAClB,qBAAK,IAAL,GAAY,OAAZ;AACH,aAFD,MAEO;AACH,qBAAK,IAAL,GAAa,UAAU,EAAvB;AACH;AACJ,SAND,MAMO,IAAI,KAAK,MAAL,KAAgB,MAApB,EAA4B;AAC/B,gBAAI,OAAO,SAAX,EAAsB;AAClB,qBAAK,IAAL,GAAY,OAAZ;AACA,uBAAO,KAAP;AACH;AACD,gBAAI,OAAO,MAAM,WAAW,KAAK,GAAhB,EAAqB;AAClC,wBAAQ,KAAK,MADqB;AAElC,uBAAO,KAF2B;AAGlC,0BAAU,KAAK;AAHmB,aAArB,CAAjB;AAKA,gBAAI,UAAU,MAAM,KAAK,aAAL,CAAmB,IAAnB,CAApB;AACA,oBAAQ,GAAR,CAAY,OAAZ;AACH;AACJ,KA9BD;AA+BH,CAjCD","file":"g-compiled.js","sourcesContent":["/**\r\n * Created by Administrator on 2016/12/17.\r\n */\r\n//ʵ����koa\r\n'use strict'\r\nvar sha1 = require('sha1');\r\nvar getRawBody = require('raw-body');\r\nvar Wechat = require('./wechat');\r\nvar util = require('./util')\r\n\r\nmodule.exports = function(ops) {\r\n    //var wechat = new Wechat(ops);\r\n    return function *(next) {\r\n        console.log(this.method)\r\n\r\n        var token = ops.token;\r\n        var signature = this.query.signature;\r\n        var nonce = this.query.nonce;\r\n        var timestamp = this.query.timestamp;\r\n        var echostr = this.query.echostr;\r\n        var str = [token, timestamp, nonce].sort().join('');\r\n        var sha = sha1(str);\r\n\r\n        if (this.method === 'GET') {\r\n            if (sha != signature) {\r\n                this.body = \"wrong\";\r\n            } else {\r\n                this.body =  echostr + '';\r\n            }\r\n        } else if (this.method === 'POST') {\r\n            if (sha != signature) {\r\n                this.body = \"wrong\";\r\n                return false;\r\n            }\r\n            var data = yield getRawBody(this.req, {\r\n                length: this.length,\r\n                limit: '1mb',\r\n                encoding: this.charset\r\n            })\r\n            var content = yield util.parseXMLAsync(data);\r\n            console.log(content);\r\n        }\r\n    }\r\n}"]}